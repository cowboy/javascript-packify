w=document.getElementById("c"),g=w.getContext("2d"),E=4099,C=8191,R=[],e=l=n=L=0;I=function(a,c,d){return(i=[[[2,7],[2,6,2],[0,7,2],[2,3,2]],[[1,3,2],[6,3]],[[2,3,1],[3,6]],[[2,2,6],[0,7,1],[3,2,2],[4,7]],[[2,2,3],[1,7],[6,2,2],[0,7,4]],[[2,2,2,2],[0,15]],[[3,3]]][a%7])[(a+c)%i.length]};P=function(a,c,d){g.clearRect(0,0,99,w.height=171);g.fillText("Level",117,60);v(m,0,0);g.fillText((L/10<<0),150,60);v(I(l,0),14,1);g.fillText("Lines",117,70);v(I(k,r),x,y);g.fillText(L,150,70);g.fillText("Points",117,80);g.fillText(n,150,80);for(i in R){g.fillText(R[i][1],117,99+i*9);g.fillText(R[i][0],150,99+i*9);}};h=function(a,c,d){k=l;l=Math.random(r=0)*E<<0;x=6;y=-1};M=function(a,c,d){for(i in (o=I(k,r)))m[y+(i<<=0)]|=o[i]<<x;for(i=o=18,a=0;--o;m[o]-C?m[--i]=m[o]:a++);for(h();--i;m[i]=E)L++;a-->0&&(n+=100*1<<a);t(0,0,0)||s()};t=function(a,c,d){for(i in (o=I(k,r+d)))if(o[i]<<x+a&m[y+c+i++])return c&&M();r+=d;x+=a;P(y+=c);return 1};v=function(a,c,d){for(i in a){for(i=a[i],o=c-1;i;i%2&&g.fillRect(o*9,d*9,8,8),o++,i>>=1);d++}};B=function(a,c,d){for(i=R.length;i--&&R[i][1]<n;)R[i+1]=R[i];R[i+1]=[prompt("Nickname"),n]};s=function(a,c,d){n&&B(L=0);m=[];for(m[n=18]=C;n;m[--n]=E)h()};document.onkeydown=function(a,c,d){t((a=a.keyCode-37)?a-2?0:1:-1,a-3?0:1,a==1&1)};setInterval("if(++e>16-L/10){t(0,1,0);e=0}",40);s()